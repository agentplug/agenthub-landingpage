title: "Progress Report - 2025-11-21"
author: "GPT-5.1 Codex"
date: "2025-11-21"
status: "Draft"

## Summary

- Wired core marketplace and publishing flows to a real Postgres/Prisma backend with GitHub-based validation and open publishing.
- Landing page hero and navigation now behave correctly on first load (no blank-screen hydration issues), and auth redirects/log-out behavior match the product spec.
- Marketplace UI and agent detail pages are now fully data-driven from the database (including README-sourced code examples), completing the P0 “data‑driven marketplace & agent detail” milestone.
- Several backend services (ranking, GitHub validation, Prisma schema) are in place, but many Phase 2–3 features from the implementation design remain either unimplemented or only partially wired.

## Backlog as of 2025-11-21

### 1. Data‑driven marketplace & agent detail

- **Agent detail from API (P0) – COMPLETED 2025-11-21**  
  - Replaced the hard-coded agent map in `src/app/agents/[slug]/page.tsx` with a call to `GET /api/agents/[slug]`.  
  - Now renders name, description, category, tags (as capabilities), repo URL, creator (repo owner), usage count, and trust-related data directly from the database.  
  - Keeps the existing visual design, and pulls the “Usage” code block from the agent’s README (via a server-side API) with a generic fallback when no snippet is found.

- **Shared hooks / API clients (P1)**  
  - Add `lib/api/agents.ts` and hooks like `useAgents`, `useAgent`, `usePublish` to standardize data fetching.  
  - Refactor `/marketplace`, `/agents/[slug]`, and `/publish` pages to use these hooks instead of inline `fetch` calls.

### 2. Usage tracking & ranking

- **Usage events (P1)**  
  - Define what counts as `view`, `try`, `install` and create a small `/api/agents/[slug]/usage` endpoint.  
  - Write `AgentUsage` rows and increment `Agent.usageCount` on relevant events.

- **Dynamic aggregateScore (P1)**  
  - Recompute and persist `aggregateScore` whenever usage, flags, or featured status change using `calculateAggregateScore`.  
  - Optionally add a one-off backfill job to recalculate scores for all agents.

### 3. Community moderation

- **Flagging endpoint & service (P1)**  
  - Implement `POST /api/agents/[slug]/flag` to create `AgentFlag` rows and update `Agent.isFlagged` / `flagCount`.  
  - Connect the penalties already modeled in the ranking service to real flag data.

- **Flag UI + basic admin review (P2)**  
  - Add “Report this agent” UI on the agent detail page that calls the flag endpoint.  
  - Create a minimal admin list of open flags and an action to resolve/dismiss them.

### 4. Publish flow & trust metadata

- **Extended submission payload (P1)**  
  - Extend `publishSubmissionSchema` and `/api/publish/submit` to accept `category`, `tags[]`, `disclosureChecklist`, and `evaluationSummaryUrl`.  
  - Persist these fields and surface them in marketplace and detail views (badges, metadata sections).

- **Publish UI polish (P2)**  
  - Add form controls for category, tags, disclosures, and evaluation URL to `src/app/publish/page.tsx`.  
  - Map validation warnings/errors to clearer, grouped UI messages.

### 5. Search & filters

- **Backend search (P2)**  
  - Add a search capability (either `/api/search` or `q` support on `/api/agents`) backed by Postgres full‑text search.  
  - Move marketplace search from client-only filtering to server-driven search.

### 6. Caching, rate limiting, and resilience

- **GitHub validation caching + rate limiting (P2)**  
  - Cache results of `validateGitHubRepository` per `repoUrl+branch` for a short TTL to reduce GitHub API pressure.  
  - Add simple rate limiting for `/api/publish/submit` and `/api/github/validate-repo`.

- **Marketplace caching (P2)**  
  - Introduce basic caching for `/api/agents` responses, invalidated when a new agent is published.

### 7. Architecture alignment & cleanup

- **File-structure alignment (P2)**  
  - Introduce components like `AgentCard`, `AgentDetail`, and `TrustBadge` to match the implementation design and reduce duplication.  
  - Gradually refactor pages to use these shared pieces without breaking existing behavior.


