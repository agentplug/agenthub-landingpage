title: "Progress Report - 2025-11-18"
author: "GPT-5.1 Codex"
date: "2025-11-18"
status: "Draft"

## Outstanding Issues

1. **GitHub OAuth Callback Fails** _(Resolved 2025-11-18)_
   - Route: `/api/auth/callback/github` (impacting `/auth/signin`)
   - Error: `Invalid prisma.user.update() invocation... No record was found for an update.`
   - Cause: `signIn` callback in `src/lib/auth/options.ts` always calls `prisma.user.update` without guarding for newly created users.
   - Impact: No one can sign in, so authenticated workflows are blocked.
   - Fix: Guarded the Prisma update with a `findUnique` check so the callback only updates when the user row already exists.

2. **Publish Endpoint Unusable**
   - Route: `/api/publish/submit` (and gated actions on `/publish`)
   - Symptom: Always returns `401 You must be signed in to publish an agent.`
   - Cause: Depends on a valid session from NextAuth; since OAuth fails, submissions can’t proceed.
   - Impact: Creators can’t publish agents or test validation flow end-to-end.

3. **Marketplace shows no agents**
   - Route: `/marketplace` and `/api/agents`
   - Symptom: Response `{"agents":[],"total":0,"page":1,"limit":5}`
   - Cause: Database has no seeded agents in current environment.
   - Impact: Marketplace appears empty; demo value limited until data exists.

4. **Signed-in header state missing** _(Resolved 2025-11-18)_
   - Route/Component: `Navigation`
   - Symptom: After authenticating, UI still shows “Log in” button with no greeting.
   - Cause: Header never consumed NextAuth session in the client.
   - Fix: Hooked `useSession()` and render avatar/username with sign-out controls for both desktop and mobile menus.

5. **Routes crash post-login (Next Image host error)** _(Resolved 2025-11-18)_
   - Route: Any page after authentication (e.g., `/`, `/publish`)
   - Symptom: Red error overlay `Invalid src prop ... avatars.githubusercontent.com is not configured under images in your next.config.js`.
   - Cause: Navigation now renders the user’s GitHub avatar via `next/image`, but `next.config.js` only whitelisted `github.com`.
   - Fix: Added `avatars.githubusercontent.com` to the image domains array.

6. **First load sometimes needs refresh**
   - Route: `/` immediately after starting `npm run dev`
   - Symptom: Initial request shows “missing required error components, refreshing...” overlay until user reloads.
   - Cause: The dev server occasionally serves the fallback while the app (or error boundary) is still compiling.
   - Impact: Local DX annoyance only; should not appear in production builds.

